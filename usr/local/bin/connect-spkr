#!/bin/sh

# Part of tiny-radioCD project, originally designed & hand-crafted by macmpi
# check License at project home https://github.com/macmpi/tiny-radioCD


# Tries to connect last used-speakers, if fails try other paired speakers
MAC="$( grep "defaults.bluealsa.device " /etc/alsa/conf.d/20-bluealsa.conf | \
	grep -o "[[:xdigit:]:]\{17\}" 2> /dev/null )"

ID="$( bluetoothctl paired-devices | grep "$MAC" )"

if bluetoothctl connect "$MAC" > /dev/null 2>&1; then
	logger -st ${0##*/} "Connected to ${ID/Device $MAC /}"
else
	logger -st ${0##*/} "Failed to connected to ${ID/Device $MAC /}"
	switch-spkr
fi

[ $? -eq "1" ] && logger -st ${0##*/} "Failed to connect any Bluetooth speaker"

exit 0

