#!/bin/sh -l

# Part of tiny-radioCD project, originally designed & hand-crafted by macmpi
# check License at project home https://github.com/macmpi/tiny-radioCD


#Expects BT MAC address passed as input
MAC="$( echo "$1" | grep -o "[[:xdigit:]:]\{17\}" | tr a-z A-Z )"

[ -z "$MAC" ] && { logger -st ${0##*/} "Failed; wrong MAC address"; exit 1;}

. GLOBALS

ID="$( bluetoothctl devices Paired | grep "$MAC" )"
sleep $G_DELAY_SPKR

if ! [ "$MAC" = "$( grep "defaults.bluealsa.device " /etc/alsa/conf.d/20-bluealsa.conf | \
	grep -o "[[:xdigit:]:]\{17\}" 2> /dev/null )" ]; then
	logger -t ${0##*/} "Disconnecting ${ID/Device $MAC /}"
	bluetoothctl disconnect "$MAC" > /dev/null 2>&1
fi

exit 0

